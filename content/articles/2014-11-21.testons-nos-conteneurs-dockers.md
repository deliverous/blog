Title: Testons nos conteneurs Docker
Tags: Docker, tdd
Author: Thomas
Summary: Adepte du TDD, voici comment nous faisons pour construire nos conteneurs Docker depuis les tests ? 
Icon: /images/thumbnails/2014-05-26.twelve-factor-apps-1.illustration__square.jpg
Status: draft

Coder à l'endroit ... Pour nous, l'ordre normal des choses, c'est identifier un besoin, le tester, s'il n'est pas rempli, le coder et enfin vérifier qu'il est bien présent. Pour tous les adeptes du *Test Driven Developpement*, c'est l'enchainement logique des phases de test et de codage. Seulement voilà, comment faire pour dérouler ces étapes pour réaliser un conteneur Docker.

L'ensemble du code présenté dans cet article est consultable dans le [projet github](https://github.com/Deliverous/docker-tdd)

![Box origami]({filename}/images/2014-05-26.twelve-factor-apps-1.illustration.jpg)

# Une histoire de services

Après la lecture de [Twelve Factor Apps](2014-05-26.twelve-factor-apps-1.html), nous pouvons réduire un conteneur à la présentation d'une application ou d'une ressource distante. Donc pour tester ce service, il suffit de se connecter sur le port réseau exposé et de parler la même langue que le service. Aujourd'hui, il est possible de ranger les applications dans 3 grandes catégories :
- les applications web : expose de l'http et fournissent html, css et javascript
- les services web : expose de l'http et fournissent des objets sérialisés principalement en json et en xml
- les autres services : base de données, xmpp, etc.

On peut affirmer, sans prendre trop de risque, qu'il est possible de tester toutes ces applications dans nos langages de développement. [Capybara](https://github.com/jnicklas/capybara) permet par exemple de naviguer sur des applications web, il est aussi très simple de se brancher sur des services SOAP ou REST, enfin les pilotes pour accéder à des bases de données, des files de messages où d'autres services sont quasiment tous présents dans les langages populaires.

Pour l'exemple, j'ai choisi ruby, mais je vous invites à faire de même avec votre langage favori.

# Un peu d'organisation

Pour nos conteneurs, nous avons pris l'habitude de ranger notre dossier de travail de la façon suivante : 
- Un fichier *Rakefile* pour automatiser l'ensemble des taches
- Un fichier *Gemfile* pour gérer nos dépendances ruby
- un dossier *src* pour héberger les fichiers utiles à la construction du conteneur
- un dossier *test* pour ranger tous nos tests
